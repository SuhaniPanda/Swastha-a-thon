<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IronQuest - Anemia Detection</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.16.0"></script>
</head>
<body>

  <!-- ================= HEADER ================= -->
  <header>
    <h1>IronQuest: Gamified Anemia Management</h1>
  </header>

  <!-- ================= HERO SECTION ================= -->
  <section id="hero">
    <h2>Detect. Learn. Compete. Stay Healthy.</h2>
    <p>Upload your image to check for anemia signs and boost your IronQuest score.</p>
  </section>

  <!-- ================= IMAGE DETECTION SECTION ================= -->
  <section id="detect">
    <h2>Try Detection Now</h2>

    <input type="file" id="fileInput" accept="image/*" />
    <div class="preview-container">
      <img id="preview" style="max-width: 250px; display: none; margin-top: 10px; border-radius: 10px;" />
    </div>

    <div id="progressBar" style="width: 100%; height: 8px; background: #eee; border-radius: 5px; margin-top: 15px; display:none;">
      <div id="progressFill" style="height: 8px; width: 0%; background: linear-gradient(90deg, #667eea, #764ba2); border-radius: 5px;"></div>
    </div>

    <div id="result" style="display:none; margin-top:20px; font-size: 18px;"></div>
  </section>

  <!-- ================= OTHER SECTIONS (unchanged UI) ================= -->
  <section id="about">
    <h2>About IronQuest</h2>
    <p>
      IronQuest helps adolescents detect anemia early and manage it through an engaging, gamified experience.
      Players earn points, unlock levels, and learn healthy habits that improve iron intake.
    </p>
  </section>

  <section id="features">
    <h2>Core Features</h2>
    <ul>
      <li>AI-powered Anemia Detection</li>
      <li>Iron-Rich Food Challenges</li>
      <li>Peer Competitions</li>
      <li>School Leaderboards</li>
      <li>Achievement Badges</li>
    </ul>
  </section>

  <section id="leaderboard">
    <h2>Leaderboard</h2>
    <p>Top performing schools and users will appear here soon.</p>
  </section>

  <section id="chatbot">
    <h2>Ask IronBot (Coming Soon)</h2>
    <p>Chatbot temporarily offline for maintenance.</p>
  </section>

  <footer>
    <p>&copy; 2025 IronQuest | AI-powered Anemia Awareness Initiative</p>
  </footer>

  <!-- ================= SCRIPT SECTION ================= -->
  <script>
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const resultBox = document.getElementById('result');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');

    let model;
    async function loadModel() {
      try {
        progressBar.style.display = 'block';
        progressFill.style.width = '30%';
        model = await tf.loadLayersModel('models/model.json');
        progressFill.style.width = '100%';
        console.log('âœ… Model loaded');
      } catch (error) {
        console.error('Model load failed:', error);
        resultBox.innerHTML = '<p style="color:red;">Error loading AI model.</p>';
      }
    }
    loadModel();

    fileInput.addEventListener('change', async function () {
      const file = this.files[0];
      if (!file || !model) return;

      // Preview
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(file);

      resultBox.style.display = 'none';
      progressBar.style.display = 'block';
      progressFill.style.width = '50%';

      // Process image
      const img = new Image();
      img.src = URL.createObjectURL(file);
      img.onload = async function () {
        const tensor = tf.browser.fromPixels(img)
          .resizeNearestNeighbor([224, 224])
          .toFloat()
          .div(tf.scalar(255.0))
          .expandDims();

        progressFill.style.width = '70%';

        const prediction = model.predict(tensor);
        const value = (await prediction.data())[0];
        const label = value > 0.5 ? "Anemia Detected" : "Normal";
        const confidence = value > 0.5 ? value : 1 - value;

        progressFill.style.width = '100%';
        resultBox.style.display = 'block';
        resultBox.innerHTML = `
          <h3 style="color:#667eea;">${label}</h3>
          <p>Confidence: ${(confidence * 100).toFixed(2)}%</p>
        `;

        tf.dispose([tensor, prediction]);
      };
    });
  </script>
</body>
</html>
